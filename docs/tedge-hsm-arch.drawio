<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36" version="26.0.10">
  <diagram name="Page-1" id="YAwPFHxUQNysemsvbYTJ">
    <mxGraphModel dx="1553" dy="1024" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="G6yHNsuL1Snmdgs_8i90-2" value="Option 3: Device (host)" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1240" y="1320" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-1" value="HSM" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-2">
          <mxGeometry x="10" y="35" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-11" value="cryptoki (PKCS#11)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-2" source="G6yHNsuL1Snmdgs_8i90-4" target="G6yHNsuL1Snmdgs_8i90-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-4" value="service&lt;div&gt;(libc)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-2">
          <mxGeometry x="10" y="125" width="90" height="35" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-5" value="Alpine Linux Container (musl)" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-2">
          <mxGeometry x="190" y="95" width="270" height="170" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-7" value="unix socket" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;horizontal=0;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-5">
          <mxGeometry x="-20" y="30" width="40" height="120" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-5" source="G6yHNsuL1Snmdgs_8i90-9" target="G6yHNsuL1Snmdgs_8i90-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-9" value="tedge&lt;div&gt;(musl)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-5">
          <mxGeometry x="90" y="57.5" width="110" height="65" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-2" source="G6yHNsuL1Snmdgs_8i90-4" target="G6yHNsuL1Snmdgs_8i90-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-12" value="Option 1: Device (host)" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="1320" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-13" value="HSM" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-12">
          <mxGeometry x="10" y="35" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-14" value="cryptoki (PKCS#11)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-12" source="G6yHNsuL1Snmdgs_8i90-15" target="G6yHNsuL1Snmdgs_8i90-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-15" value="opensc&lt;div&gt;server&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-12">
          <mxGeometry x="10" y="125" width="90" height="35" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-16" value="Debian Linux Container (glibc)" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-12">
          <mxGeometry x="150" y="95" width="310" height="170" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-19" value="tedge&lt;div&gt;(glibc)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-16">
          <mxGeometry x="220" y="95" width="80" height="65" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-22" value="pkcs#11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;fontSize=10;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-16" source="G6yHNsuL1Snmdgs_8i90-19" target="G6yHNsuL1Snmdgs_8i90-21">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1220" y="235" as="sourcePoint" />
            <mxPoint x="1140" y="235" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-21" value="p11 client&lt;div&gt;.so&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-16">
          <mxGeometry x="120" y="72.5" width="60" height="35" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-12" source="G6yHNsuL1Snmdgs_8i90-15" target="G6yHNsuL1Snmdgs_8i90-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-17" value="unix socket" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;horizontal=0;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-12">
          <mxGeometry x="140" y="145" width="30" height="80" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-18" value="pkcs#11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-12" source="G6yHNsuL1Snmdgs_8i90-21" target="G6yHNsuL1Snmdgs_8i90-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-33" value="Containers" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=29;" vertex="1" parent="1">
          <mxGeometry x="40" y="1210" width="340" height="50" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-34" value="Interfacing with Hardware Security Modules" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=29;" vertex="1" parent="1">
          <mxGeometry x="80" y="20" width="610" height="50" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-36" value="Device (Linux)" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="450" height="350" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-44" value="Hardware Security Modules" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="20" y="30" width="410" height="70" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-37" value="Yubikey" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="30" y="65" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;startFill=0;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-41" target="G6yHNsuL1Snmdgs_8i90-59">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-41" value="tedge&lt;div&gt;(glibc)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="170" y="270" width="110" height="65" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-43" value="SoftHSM" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="130" y="65" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-45" value="TPM 2.0" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="230" y="65" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-47" target="G6yHNsuL1Snmdgs_8i90-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-47" value="Yubikey&lt;div&gt;(shared object)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="30" y="140" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-48" target="G6yHNsuL1Snmdgs_8i90-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-48" value="SoftHSM&lt;div&gt;(shared object)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="130" y="140" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-49" target="G6yHNsuL1Snmdgs_8i90-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-49" value="TPM 2.0&lt;div&gt;(shared object)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="230" y="140" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-50" value="Arm TrustZone&lt;div&gt;(shared object)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="330" y="140" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-59" target="G6yHNsuL1Snmdgs_8i90-47">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-62" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-59" target="G6yHNsuL1Snmdgs_8i90-48">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-59" target="G6yHNsuL1Snmdgs_8i90-49">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-59" target="G6yHNsuL1Snmdgs_8i90-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-59" value="PKCS#11 (cryptoki) API" style="line;strokeWidth=4;html=1;perimeter=backbonePerimeter;points=[];outlineConnect=0;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="80" y="220" width="290" height="10" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-46" value="Arm TrustZone" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="330" y="65" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;endArrow=none;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-36" source="G6yHNsuL1Snmdgs_8i90-50" target="G6yHNsuL1Snmdgs_8i90-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-85" value="&lt;b&gt;configuration:&lt;/b&gt;&lt;div&gt;&lt;div&gt;SO_MODULE=&amp;lt;path&amp;gt;&lt;/div&gt;&lt;div&gt;KEY_URI=&amp;lt;pkcs11:token&amp;gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-36">
          <mxGeometry x="300" y="285" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-66" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Build Challenges&lt;/h1&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;* Do we want to also build glibc in addition to musl builds?&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp;* zigbuild can be used to control the glibc version, e.g. 2.17 so it is very compatible, but it can&#39;t be used to build all targets (but the main ones at least)&lt;/p&gt;&lt;p&gt;* Building crypto libraries is very difficult at this point in time (ring is actually better than aws-lc-rs!), and building for both musl and glibc is not a guarentee&lt;/p&gt;&lt;p&gt;Some MUSL limitations&lt;/p&gt;&lt;p&gt;* No support for NSS (Name Service Switch) - Fedora IoT users issue (https://github.com/thin-edge/thin-edge.io/issues/2042)&lt;/p&gt;&lt;p&gt;* Can&#39;t load shared library objects (though maybe this is the last one?)&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="2370" width="360" height="332.5" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-67" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Option 3: Custom cryptoki proxy service&lt;br&gt;&lt;/h1&gt;&lt;div&gt;Create client which can act as a proxy between a unix socket (used by tedge) and the cryptoki libraries. It must be compiled with glibc so it can load the shared objects.&lt;br&gt;&lt;br&gt;There is an existing project which provides such a service, called &quot;parsec&quot; (https://parallaxsecond.github.io/parsec-book/) which provides a unix socket, and a custom client library to interact with different HSMs (via PKCS#11 and other providers)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Advantages&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* No change in build targets (keep with musl)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Disadvantages&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Need to worry about security of the unix socket (is just protecting the socket good enough)?&lt;/div&gt;&lt;div&gt;* Socket ownership is still challenging when using non-root users inside the container&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* How to manage the service on the host? (e.g. updating etc.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1240" y="1640" width="380" height="440" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-68" value="Option 2: Device (host)" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="640" y="1320" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-69" value="HSM" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-68">
          <mxGeometry x="10" y="35" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-70" value="cryptoki (PKCS#11)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-68" source="G6yHNsuL1Snmdgs_8i90-71" target="G6yHNsuL1Snmdgs_8i90-69">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-71" value="opensc&lt;div&gt;server&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-68">
          <mxGeometry x="10" y="125" width="90" height="35" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-72" value="Alpine Linux Container (musl)" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-68">
          <mxGeometry x="150" y="95" width="310" height="170" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-73" value="tedge&lt;div&gt;(musl)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-72">
          <mxGeometry x="230" y="95" width="70" height="65" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-74" value="via&lt;div&gt;cli&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-72" source="G6yHNsuL1Snmdgs_8i90-73" target="G6yHNsuL1Snmdgs_8i90-75">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1220" y="235" as="sourcePoint" />
            <mxPoint x="1140" y="235" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-75" value="opensc&lt;div&gt;client&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-72">
          <mxGeometry x="90" y="72.5" width="60" height="35" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-76" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-68" source="G6yHNsuL1Snmdgs_8i90-71" target="G6yHNsuL1Snmdgs_8i90-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-77" value="unix socket" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;horizontal=0;" vertex="1" parent="G6yHNsuL1Snmdgs_8i90-68">
          <mxGeometry x="140" y="145" width="30" height="80" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="G6yHNsuL1Snmdgs_8i90-68" source="G6yHNsuL1Snmdgs_8i90-75" target="G6yHNsuL1Snmdgs_8i90-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-79" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Option 1: Use Debian container and compile with glibc&lt;br&gt;&lt;/h1&gt;&lt;div&gt;Use p11-kit server/client which communicates via a unix socket to the host to access the HSMs.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;See&amp;nbsp;https://p11-glue.github.io/p11-glue/p11-kit/manual/remoting.html&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Advantages&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* No change in build targets (keep with musl)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* No custom software (only to interface with the cryptoki library)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Disadvantages&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;* Need to change to musl build (though only for the container?)&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Larger container images (~35MB larger)&lt;/div&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="1640" width="380" height="400" as="geometry" />
        </mxCell>
        <mxCell id="G6yHNsuL1Snmdgs_8i90-80" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Option 2: Use cli interface to sign tls&lt;br&gt;&lt;/h1&gt;&lt;div&gt;Create client which can act as a proxy between a unix socket (used by tedge) and the cryptoki libraries. It must be compiled with glibc so it can load the shared objects.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Advantages&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* No change in build targets (keep with musl)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* No permission problems (can easily use sudo to elevate to root)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Disadvantages&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Cumbersome to maintain (is the cli commands/args stable?)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Not easy to extend for future use-cases (e.g. also use it to encrypt/decrypt data)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Slower than (not sure if this is really a problem)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* Need to worry about security of the unix socket (is just protecting the socket good enough)?&lt;/div&gt;&lt;div&gt;* Socket ownership is still challenging when using non-root users inside the container&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;* How to manage the service on the host? (e.g. updating etc.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="640" y="1640" width="380" height="500" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
